<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Variables globales
let carrito = [];
const modalCarrito = new bootstrap.Modal(document.getElementById('modalCarrito'));
const modalPago = new bootstrap.Modal(document.getElementById('modalPago'));

// Mostrar modal de publicidad al cargar la página
window.addEventListener('DOMContentLoaded', () => {
    const modalPublicidad = new bootstrap.Modal(document.getElementById('modalPublicidad'));
    modalPublicidad.show();
});

// Función para actualizar el contador del carrito
function actualizarContadorCarrito() {
    const contador = document.getElementById('contador-carrito');
    const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);
    contador.textContent = totalItems;
}

// Función para renderizar los items del carrito
function renderizarCarrito() {
    const itemsCarrito = document.getElementById('items-carrito');
    const totalCarrito = document.getElementById('total-carrito');
    const totalPagar = document.getElementById('total-pagar');
    
    itemsCarrito.innerHTML = '';
    
    if (carrito.length === 0) {
        itemsCarrito.innerHTML = '<p class="text-center">Tu carrito está vacío</p>';
        totalCarrito.textContent = 'S/ 0.00';
        return;
    }
    
    let total = 0;
    
    carrito.forEach(item => {
        const precioTotalItem = item.precio * item.cantidad;
        total += precioTotalItem;
        
        const itemHTML = `
            <div class="item-carrito row align-items-center mb-3">
                <div class="col-md-2">
                    <img src="${item.imagen}" alt="${item.nombre}" class="img-fluid">
                </div>
                <div class="col-md-4">
                    <h6>${item.nombre}</h6>
                </div>
                <div class="col-md-3">
                    <div class="input-group">
                        <button class="btn btn-outline-secondary btn-restar" data-id="${item.id}">-</button>
                        <input type="text" class="form-control text-center" value="${item.cantidad}" readonly>
                        <button class="btn btn-outline-secondary btn-sumar" data-id="${item.id}">+</button>
                    </div>
                </div>
                <div class="col-md-2 text-end">
                    <span>S/ ${precioTotalItem.toFixed(2)}</span>
                </div>
                <div class="col-md-1 text-end">
                    <button class="btn btn-danger btn-eliminar" data-id="${item.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
        
        itemsCarrito.innerHTML += itemHTML;
    });
    
    totalCarrito.textContent = `S/ ${total.toFixed(2)}`;
    totalPagar.textContent = `S/ ${total.toFixed(2)}`;
    
    // Agregar eventos a los botones recién creados
    document.querySelectorAll('.btn-restar').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(e.target.getAttribute('data-id'));
            restarItem(id);
        });
    });
    
    document.querySelectorAll('.btn-sumar').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(e.target.getAttribute('data-id'));
            sumarItem(id);
        });
    });
    
    document.querySelectorAll('.btn-eliminar').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(e.target.getAttribute('data-id'));
            eliminarItem(id);
        });
    });
}

// Funciones para manipular el carrito
function agregarItem(id) {
    const producto = obtenerProductoPorId(id);
    
    if (!producto) return;
    
    const itemExistente = carrito.find(item => item.id === id);
    
    if (itemExistente) {
        itemExistente.cantidad += 1;
    } else {
        carrito.push({
            id: producto.id,
            nombre: producto.nombre,
            precio: producto.precio,
            imagen: producto.imagen,
            cantidad: 1
        });
    }
    
    actualizarContadorCarrito();
    renderizarCarrito();
}

function restarItem(id) {
    const item = carrito.find(item => item.id === id);
    
    if (item && item.cantidad > 1) {
        item.cantidad -= 1;
    } else {
        eliminarItem(id);
    }
    
    actualizarContadorCarrito();
    renderizarCarrito();
}

function sumarItem(id) {
    const item = carrito.find(item => item.id === id);
    
    if (item) {
        item.cantidad += 1;
    }
    
    actualizarContadorCarrito();
    renderizarCarrito();
}

function eliminarItem(id) {
    carrito = carrito.filter(item => item.id !== id);
    actualizarContadorCarrito();
    renderizarCarrito();
}

// Función para obtener los datos del producto
function obtenerProductoPorId(id) {
    // Aquí deberías tener una lista de productos con sus datos
    // Por ahora, simularemos algunos datos basados en tu HTML
    const productos = [
        {
            id: 1,
            nombre: "Box Sun Flower",
            precio: 30, // Precio base para 2 girasoles
            imagen: "Imagen de WhatsApp 2025-04-28 a las 19.14.06_6df5448f.jpg"
        },
        {
            id: 2,
            nombre: "Ramo de Rosas Rojas",
            precio: 120,
            imagen: "https://images.unsplash.com/photo-1526047932273-341f2a7631f9?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"
        },
        {
            id: 3,
            nombre: "Arreglo de Girasoles",
            precio: 80,
            imagen: "https://images.unsplash.com/photo-1490750967868-88aa4486c946?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"
        },
        {
            id: 4,
            nombre: "Ramo de Tulipanes Rosados",
            precio: 130,
            imagen: "https://images.unsplash.com/photo-1616594039964-0a45d7f7efdf?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"
        },
        {
            id: 5,
            nombre: "Centro de Mesa Floral",
            precio: 180,
            imagen: "https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"
        },
        {
            id: 6,
            nombre: "Arreglo de Orquídeas Blancas",
            precio: 200,
            imagen: "https://images.unsplash.com/photo-1556228578-5a87f1b92e6d?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"
        }
    ];
    
    return productos.find(producto => producto.id === id);
}

// Eventos
document.addEventListener('DOMContentLoaded', () => {
    // Botones "Añadir al carrito"
    document.querySelectorAll('.btn-agregar').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(e.target.getAttribute('data-id'));
            agregarItem(id);
            
            // Mostrar notificación
            const producto = obtenerProductoPorId(id);
            if (producto) {
                alert(`¡${producto.nombre} añadido al carrito!`);
            }
        });
    });
    
    // Icono del carrito
    document.getElementById('carrito-icono').addEventListener('click', () => {
        modalCarrito.show();
    });
    
    // Botón Vaciar Carrito
    document.getElementById('vaciar-carrito').addEventListener('click', () => {
        if (confirm('¿Estás seguro de que quieres vaciar el carrito?')) {
            carrito = [];
            actualizarContadorCarrito();
            renderizarCarrito();
        }
    });
    
    // Botón Pagar
    document.getElementById('pagar-carrito').addEventListener('click', () => {
        if (carrito.length === 0) {
            alert('Tu carrito está vacío');
            return;
        }
        
        modalCarrito.hide();
        modalPago.show();
    });
    
    // Selección de método de pago
    document.querySelectorAll('.metodo-pago').forEach(metodo => {
        metodo.addEventListener('click', () => {
            document.querySelectorAll('.metodo-pago').forEach(m => {
                m.classList.remove('border-success', 'border-3');
            });
            
            metodo.classList.add('border-success', 'border-3');
            document.getElementById('confirmar-pago').classList.remove('d-none');
        });
    });
    
    // Confirmar pago
    document.getElementById('confirmar-pago').addEventListener('click', () => {
        document.getElementById('confirmacion-pago').classList.remove('d-none');
        document.getElementById('confirmar-pago').classList.add('d-none');
        
        // Aquí podrías añadir lógica para enviar el pedido por WhatsApp
        setTimeout(() => {
            modalPago.hide();
            carrito = [];
            actualizarContadorCarrito();
            renderizarCarrito();
            
            // Redirigir a WhatsApp con el pedido
            const mensaje = "Hola Rosamía, quiero hacer un pedido con los siguientes productos:\n\n" +
                carrito.map(item => `- ${item.nombre} (${item.cantidad} x S/${item.precio.toFixed(2)})`).join('\n') +
                `\n\nTotal: S/${carrito.reduce((total, item) => total + (item.precio * item.cantidad), 0).toFixed(2)}`;
            
            window.open(`https://wa.me/51931754214?text=${encodeURIComponent(mensaje)}`, '_blank');
        }, 2000);
    });
});
</script>